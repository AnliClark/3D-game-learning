# 【Unity】第一人称射击游戏

## 一、前言
本游戏为一款射击小游戏，玩家可以在草地上使用十字弩射击靶子与小动物。本游戏实况已放至Bilibili:

游戏源码已放至：

## 二、需求分析与游戏整体设计
无论做什么游戏，都需要先明确好需求，并确定玩家可能的交互。

简要的需求分析如下：

   1. 玩家首先阅读新手教程
   2. 玩家正式开始游戏
   3. 玩家可以通过键盘和鼠标自由移动
   4. 玩家只能在射击区域射击
   5. 玩家按住右键蓄力，松开蓄力完成
   6. 玩家按下左键发射
   7. 玩家射中猎物即可得分
   8. 总共3个射击区域，每个区域可以发射10次箭，发射完毕后结束游戏
   9. 玩家可以重启游戏
   10. 右上角有个小地图，按下m键可以调整小地图的视野
   
用户的交互表如下：
|动作|结果|备注|
|----|----|----|
|点击开始按钮|游戏开始||
|移动鼠标|摄像机旋转||
|按下awsd|人物移动||
|按下空格|人物跳跃||
|按住右键|拉弓蓄力||
|按下左键|射击|需要先按下右键|
|按下m键|调整小地图的视野||
|按下r键|游戏重启||
|射中猎物|得分|||
|玩家进入射击区域|允许射击||
|玩家离开射击区域|禁止射击||
|玩家射完所有箭|游戏结束||

从以上的简要分析，可以看出，与我往期做的小游戏不同，本游戏的玩家拥有更多的交互行为，所以需要更多的把重心放在玩家交互上。

## 三、MVC与门面模式

本次依然采用MVC与门面模式。但是从第二部分，可以看出，本游戏需要的视图与模型的部分并不多。

视图主要为交互数据与ui按钮的显示，而模型部分主要为猎物的数据。

控制器方面，本次游戏所需操作的对象有很多：需要控制玩家的移动，猎物的随机移动，箭的生成与射出等等。

控制器的需求与用户交互息息相关，我们采用门面模式来实现用户交互与控制核心的分离。
*FirstSceneController*实现了*IUSerAction*接口，而负责用户交互的*UserInteraction*与*FirstPersonContorller*则在用户有交互时调用相应的接口函数，以此实现解耦合。

## 四、物品控制
### 1.人物控制
人物的控制直接采用了Unity官方资源包的第一人称控制器。
### 2.猎物控制
由于需要有运动靶，我们还需要控制猎物的运动。我使用的猎物素材为兔子，兔子需要贴着地面行走，而我使用的地形是凹凸不平的。故而，为了保证兔子能够始终贴着地面行走，我为兔子加上了刚体组件，并另其使用重力，之后再给兔子一个向前的力，即可令兔子贴地行走（其中，向前的方向使用`transform.forwards`获取）。

在这个过程中，我遇到了一些困难：兔子在行走时虽然贴地，但是却会摔倒，并且还可能会发生旋转。在解决问题的过程中，我先把兔子的碰撞器从*box*更改为了*capsule*，之后又在刚体的的旋转约束中，限制了x、y和z轴的旋转，终于使得兔子可以正常移动。

而当运动靶（兔子）被击中时，会触发动画*Die*，这只需要设置好动画状态机，再在代码里调用*SetTrigger*即可。
### 3.十字弩与箭的控制
十字弩的*Empty*动画中，十字弩中的箭会停留在射出去一段距离的状态，此时需要把十字弩中的箭
